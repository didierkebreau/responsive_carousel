/*jslint browser: true, nomen: true, white: true */
/*!
 * responsiveCarousel
 * A responsive carousel that works in desktop browsers, ipad, iphone, and even
 * most Androids.  It uses css3 animations with a jquery animation fallback for
 * greater speed.  The code was optimized to minimize page reflows to further
 * enhance the overall speed..
 *
 * This is a jQuery UI Widget
 *
 * @version 1.7.1
 * @releaseDate 5/23/2013
 * @author Matthew Toledo
 * @url https://github.com/mrbinky3000/responsive_carousel
 * @requires jQuery, jQuery UI (only the Core and Widget Factory), modernizr (only css3 transitions test, touch test optional), hammer.js
 */
(function(d,f,q){var p=0;d.widget("ri.responsiveCarousel",{options:{arrowLeft:".arrow-left span",arrowRight:".arrow-right span",mask:".slider-mask",target:"ul",unitElement:"li",unitWidth:"inherit",responsiveUnitSize:null,onRedraw:null,ondragstart:null,ondragend:null,dragEvents:!1,easing:"linear",speed:400,slideSpeed:2500,step:-1,responsiveStep:null,onShift:null,cssAnimations:Modernizr.csstransitions,nudgeThreshold:10,infinite:!1,delta:1,dragVertical:!1,dragPreventDefault:!1,lazyload:!1},_getPrefix:function(b){for(var c=
["Moz","Webkit","Khtml","0","ms"],a=q.createElement("div"),e=b.charAt(0).toUpperCase()+b.slice(1),d="",h=c.length;-1<h;)void 0!==a.style[c[h]+e]&&(d=c[h]),h-=1;return d=a.style[b]?b.toLowerCase():"-"+d.toLowerCase()+"-"},_round:function(b){if("compute"===this.options.unitWidth||"inherit"===this.options.unitWidth||"integer"===this.options.unitWidth)b=Math.round(b/this.internal.unitWidth)*this.internal.unitWidth;return b},_animate:function(b,c,a,e){var g=this.options,h=this.internal,j=h.prefix+"transition",
l=this._round(Math.floor(b.position().left)),k=c.left,m=l+k;b.css(j,"");var n=d('<div class="redraw-'+p+'"> </div>');n.appendTo(b);n.hide();n.get(0).offsetHeight;n.show();f.setTimeout(function(){n.remove()},1);!0===g.infinite&&void 0!==k&&(k<l?(k=-1*h.unitWidth*(h.numUnits-h.numVisibleUnits),l===k&&(b.css("left",0),c.left=-h.unitWidth)):k>l&&0===l&&(k=-1*Math.floor(b.find(".clone:first").position().left),b.css("left",k),c.left=k+m));f.setTimeout(function(){g.cssAnimations?(b.css(j,"left "+a/1E3+"s "+
g.easing),b.css(c),f.setTimeout(function(){b.css(j,"");d.isFunction(e)&&e()},a)):b.animate(c,a,function(){d.isFunction(e)&&e()})},1)},_requestAnimationFrameShim:function(){var b=0,c=["ms","moz","webkit","o"],a;if(!f.requestAnimationFrame||!f.cancelAnimationFrame){for(a=0;a<c.length&&!f.requestAnimationFrame;a+=1)f.requestAnimationFrame=f[c[a]+"RequestAnimationFrame"],f.cancelAnimationFrame=f[c[a]+"CancelAnimationFrame"]||f[c[a]+"CancelRequestAnimationFrame"];f.requestAnimationFrame||(f.requestAnimationFrame=
function(a){var c=(new Date).getTime(),d=Math.max(0,16-(c-b)),j=f.setTimeout(function(){a(c+d)},d);b=c+d;return j});f.cancelAnimationFrame||(f.cancelAnimationFrame=function(a){clearTimeout(a)})}},_setTargetWidth:function(){var b=this.internal,c=this.options;b.numUnits=d(c.unitElement).length;"individual"===c.unitWidth?(b.targetWidth=0,d(c.unitElement).each(function(){var a=d(this),c;a.css("width","");c=Math.ceil(a.width())+1;a.width(c);b.targetWidth+=c;d(this).data("responsiveCarousel",{width:c,top:Math.floor(a.position().top),
right:Math.floor(a.position().left)+a.width(),bottom:Math.floor(a.position().top)+a.height(),left:Math.floor(a.position().left),totalRight:b.targetWidth})})):b.targetWidth=b.numUnits*b.unitWidth;d(c.target).width(b.targetWidth);b.targetHeight=d(c.target).height();b.maskWidth=d(c.mask).width();b.maskHeight=d(c.mask).height()},_setArrowVisibility:function(){var b=this.options,c=this.internal,a=d(b.target),e=d(b.arrowLeft),g=d(b.arrowRight),h,j=c.maskWidth,a=this._round(Math.floor(a.position().left)),
f=c.targetWidth+a;g.length&&(!0!==b.infinite&&f<=j?(g.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowRightVisible=c.isArrowBeingClicked=!1):(g.removeClass("disabled"),c.arrowRightVisible=!0));e.length&&(!0!==b.infinite&&0<=a?(e.addClass("disabled"),!0===c.isArrowBeingClicked&&this._clearInterval(),c.arrowLeftVisible=c.isArrowBeingClicked=!1):(e.removeClass("disabled"),c.arrowLeftVisible=!0));"individual"!==b.unitWidth&&(c.currentSlide=d(b.unitElement).eq([Math.abs(a/
c.unitWidth)]).data("slide"),h=c.currentSlide);if(d.isFunction(b.onShift)){if("number"===typeof h)b.onShift(h)}else if(null!==b.onShift)throw Error("The onShift option must be a function or null if not in use.");},_clearInterval:function(){var b=this.internal;"number"===typeof b.timer&&(b.isArrowBeingClicked=!1,f.clearInterval(b.timer))},_doArrowBeingClicked:function(b){var c=this,a=this.internal,e=this.options,g=d(e.target),h=Math.floor(g.position().left),j,f,k=a.currentSlide;if(!0!==a.busy){if("individual"===
e.unitWidth)if("right"===b)if("right"===a.lastArrowClicked)k<a.numUnits-1&&(k+=1,b=d(e.unitElement).eq(k).data("responsiveCarousel"),j=h-b.width,a.currentSlide=k);else{a.lastArrowClicked="right";for(f=-1*h+a.maskWidth;k<a.numUnits;){b=d(e.unitElement).eq(k).data("responsiveCarousel");if(f>=b.left&&f<=b.right){j=h-(b.right-f);a.currentSlide=k;break}k+=1}}else if("left"===b)if("left"===a.lastArrowClicked)0<k&&(k-=1,b=d(e.unitElement).eq(k).data("responsiveCarousel"),j=h+b.width,a.currentSlide=k);else{if(a.lastArrowClicked=
"left",d(e.unitElement).eq(a.currentSlide).length)for(f=Math.abs(h);0<=k;){b=d(e.unitElement).eq(k).data("responsiveCarousel");if(f>=b.left&&f<=b.right){j=h+b.width;b.right>f&&(j-=b.right+h);a.currentSlide=k;break}k-=1}}else throw Error("unknown direction");else if("left"===b)j=h+a.unitWidth;else if("right"===b)j=h-a.unitWidth;else throw Error("unknown direction");j=this._round(j);a.busy=!0;this._animate(g,{left:j},e.speed,function(){c._setArrowVisibility("_doArrowBeingClicked");a.busy=!1})}},_setArrowEvents:function(){var b=
this,c=this.options,a=this.internal,e=d(c.arrowLeft),g=d(c.arrowRight),h="",j="";e.on("click"+this.instanceId,function(a){a.preventDefault()});g.on("click"+this.instanceId,function(a){a.preventDefault()});!0===c.dragEvents?(h="mousedown"+this.instanceId+" touchstart"+this.instanceId+" gesturestart"+this.instanceId+" gesturechange"+this.instanceId,j="mouseup"+this.instanceId+" mouseout"+this.instanceId+" mouseleave"+this.instanceId+" touchend"+this.instanceId+" touchleave"+this.instanceId+" gestureend"+
this.instanceId):(h="mousedown"+this.instanceId,j="mouseup"+this.instanceId+" mouseout"+this.instanceId+" mouseleave"+this.instanceId);e.on(h,function(c){!0===a.ios6Device&&(a.busy=!1);c.preventDefault();c.stopPropagation();!1===a.busy&&!e.hasClass("disabled")&&(a.isArrowBeingClicked=a.firstMouseClick=!0,a.timer=f.setInterval(function(){b._doArrowBeingClicked("left")},10),a.slideTimer&&(f.clearInterval(a.slideTimer),a.slideShowActive=!1))});g.on(h,function(c){!0===a.ios6Device&&(a.busy=!1);c.preventDefault();
c.stopPropagation();!1===a.busy&&!g.hasClass("disabled")&&(a.isArrowBeingClicked=a.firstMouseClick=!0,a.timer=f.setInterval(function(){b._doArrowBeingClicked("right")},10),a.slideTimer&&(f.clearInterval(a.slideTimer),a.slideShowActive=!1))});d.each([e,g],function(){d(this).on(j,function(){!0===a.isArrowBeingClicked&&b._clearInterval()})});d(f).on("scroll"+this.instanceId,function(){"individual"!==c.unitWidth&&(f.clearTimeout(a.scrollTimer),a.scrollTimer=f.setTimeout(function(){b._clearInterval()},
100))});d(f).on(" resize"+this.instanceId+" onorientationchange"+this.instanceId,function(){f.clearTimeout(a.resizeTimer);a.resizeTimer=f.setTimeout(function(){b._setTargetWidth();b._clearInterval()},100)})},_setUnitWidth:function(){var b,c,a=this,e=this.internal,g=this.options,h=d(g.target),j=d(this.element),l=d(g.unitElement+":not(.clone)"),k=l.eq(0),m=function(){e.unitWidth=k.width()},n=function(){e.maskWidth=d(g.mask).width();c=g.responsiveUnitSize(j,e,g);if("number"!==typeof c||1>c)throw Error("The responsiveUnitSize callback must return a whole number greater than 0");
b=e.maskWidth/c;b=Math.floor(b);d(g.unitElement).css("width",b);!0===g.infinite&&(0<c&&c!==e.numVisibleUnits)&&(e.numVisibleUnits=c,h.find(".clone").remove(),l.slice(0,e.numVisibleUnits).clone(!0).addClass("clone").appendTo(h));e.unitWidth=b;e.numVisibleUnits=c};if("inherit"===g.unitWidth)m(),h.find("img").one("load"+a.instanceId,function(){m();a._setTargetWidth();a._setArrowVisibility();if(d.isFunction(g.onRedraw))g.onRedraw(j,e,g)});else if("individual"===g.unitWidth){if(d.isFunction(g.onRedraw))g.onRedraw(j,
e,g);h.find("img").one("load"+a.instanceId,function(){if(!1===h.is(":hidden")||!0===h.is(":visible"))f.clearTimeout(e.imageLoadTimer),e.imageLoadTimer=f.setTimeout(function(){a._setTargetWidth();a._setArrowVisibility();if(d.isFunction(g.onRedraw))g.onRedraw(j,e,g)})});d(f).on("resize"+a.instanceId,function(){var b=e.currentSlide;clearTimeout(e.setWidthTimer);e.setWidthTimer=setTimeout(function(){var c;if(!1===h.is(":hidden")||!0===h.is(":visible"))a._setTargetWidth(),c=d(g.unitElement).eq(b).data("responsiveCarousel"),
"right"===e.lastArrowClicked?c=e.maskWidth-c.totalRight:"left"===e.lastArrowClicked&&0<b?c=-1*d(g.unitElement).eq(b-1).data("responsiveCarousel").totalRight:(c=0,e.currentSlide=0),h.css({left:c}),f.requestAnimationFrame(function(){a._setArrowVisibility("_setUnitWidth individual resize");if(d.isFunction(g.onRedraw))g.onRedraw(j,e,g)})},400)})}else if("compute"===g.unitWidth){m();d.isFunction(g.responsiveUnitSize)&&(n(),m());if(d.isFunction(g.onRedraw))g.onRedraw(j,e,g);h.find("img").each(function(){d(this).one("load"+
a.instanceId,function(){if(!1===h.is(":hidden")||!0===h.is(":visible"))f.clearTimeout(e.imageLoadTimer),e.imageLoadTimer=f.setTimeout(function(){d.isFunction(g.responsiveUnitSize)&&n();m();a._setTargetWidth();a._setArrowVisibility();if(d.isFunction(g.onRedraw))g.onRedraw(j,e,g)},400)})});d(f).on("resize"+a.instanceId,function(){var b=e.currentSlide;f.clearTimeout(e.setWidthTimer);if(!1===h.is(":hidden")||!0===h.is(":visible"))e.setWidthTimer=setTimeout(function(){var c,f=-1*e.numUnits*e.unitWidth+
e.maskWidth;d.isFunction(g.responsiveUnitSize)&&(n(),m());m();a._setTargetWidth();c=-1*b*e.unitWidth;c<f&&(c=e.maskWidth-e.targetWidth);h.css({left:c});a._setArrowVisibility();if(d.isFunction(g.onRedraw))g.onRedraw(j,e,g)},500)})}else e.unitWidth=g.unitWidth},_dragEvents:function(){var b=this,c=this.options,a=this.internal,e=d(c.target),g=d(c.mask),g=new Hammer(g.get(0),{prevent_default:c.dragPreventDefault,css_hacks:!0,drag:!0,drag_vertical:c.dragVertical,drag_horizontal:!0,drag_min_distance:0,swipe:!1,
transform:!1,tap:!1,tap_double:!1,hold:!1}),h={};a.touchObject=g;g.ondragstart=function(){b.stopSlideShow();f.cancelAnimationFrame(a.dragTimer);if(!0===a.isArrowBeingClicked||!0===a.busy)return{};a.busy=!0===a.ios6Device?!1:!0;h={top:parseInt(e.css("top"),10),left:parseInt(e.css("left"),10)};h.time=(new Date).getTime();a.scrollStart=h;if(d.isFunction(c.ondragstart))c.ondragstart(c,a)};g.ondrag=function(b){a.dragTimer=f.requestAnimationFrame(function(){if(!0!==a.isArrowBeingClicked){var d=c.delta,
g,f,n=-1*a.unitWidth*(a.numUnits-a.numVisibleUnits);if("up"===b.direction||"left"===b.direction)b.distance*=-1;g=h.left+b.distance*d;f=Math.abs(a.scrollStart.left-g);a.nudgeDirection=f>c.nudgeThreshold&&f<a.unitWidth/2?"up"===b.direction||"left"===b.direction?"left":"right":f<=c.nudgeThreshold?"abort":null;!0===c.infinite&&(g<=n&&(g=b.distance*d,a.scrollStart.left=0),0<=g&&(g=n+b.distance*d,a.scrollStart.left=n));a.left=g;e.css("left",g)}})};g.ondragend=function(){f.cancelAnimationFrame(a.dragTimer);
e.stop(!0,!1);f.requestAnimationFrame(function(){b._animate(e,{left:b.computeAdjust(e)},c.speed,function(){b._setArrowVisibility();a.busy=!1;if(d.isFunction(c.ondragend))c.ondragend(c,a)})})}},_create:function(){p+=1;var b=this.options,c=d(this.element),a=d(b.target);this.instanceId=".carousel_"+p.toString(10);this.internal={busy:!1,currentSlide:0,left:0,targetWidth:0,targetHeight:0,maskWidth:0,maskHeight:0,unitWidth:0,targetBackupCopy:null,isArrowBeingClicked:!1,lastArrowClicked:null,arrowLeftVisible:!0,
arrowRightVisible:!0,targetLeft:0,timer:null,dragTimer:null,dragEndTimer:null,scrollTimer:null,resizeTimer:null,firstMouseClick:!1,prefix:null,slideShowActive:!1,slideTimer:null,slideBumped:!1,nudgeDirection:null,infinite:!1,numUnits:null,numVisibleUnits:null,scrollStart:0,touchObject:null,setWidthTimer:null,lazyloaded:!1,ios6Device:!1};this.internal.backup=a.clone(!0,!0);this.options.cssAnimations&&(this.internal.prefix=this._getPrefix("transition"));/(iPhone|iPod|iPad)/i.test(navigator.userAgent)&&
/OS 6_/i.test(navigator.userAgent)&&(this.internal.ios6Device=!0);this._requestAnimationFrameShim();a.css({position:"relative",left:0});a.addClass("instance-"+p);d(b.unitElement).each(function(a){d(this).attr({"data-slide":a})});!0===b.dragEvents&&this._dragEvents();this._setArrowEvents();!0===b.lazyload&&d(b.target).find("img.lazy-slider").lazyload({effect:"fadeIn",skip_invisible:!1});if(!0===a.is(":visible")||!1===a.is(":hidden"))this._setUnitWidth(),this._setTargetWidth(),this._setArrowVisibility(),
!0===b.lazyload&&this._lazyLoad();if(d.isFunction(b.onRedraw))b.onRedraw(c,this.internal,b)},_lazyLoad:function(){function b(){var a,b=d(h.unitElement);for(j=e.currentSlide;j<l;j+=1)a=b.eq(j),a.length&&a.find('img.lazy-slider:not([loaded="true"])').each(function(){d(this).trigger("appear")})}function c(){d(h.target).find('img.lazy-slider:not([loaded="true"])').each(function(){d(this).trigger("appear")})}function a(){var a=d(h.target).offset().top,b=d(f).scrollTop()+d(f).height()+600,e=!1;a<b&&(c(),
e=!0);return e}var e=this.internal,g=this.instanceId,h=this.options,j,l=e.currentSlide+2*e.numVisibleUnits;if(!0===d.browser.msie&&"8."===d.browser.version.substring(0,2))c();else if(!1===e.lazyloaded){b();d(f).on("load",function(){b()});if(!0===h.dragEvents){if(!1===a())d(f).on("scroll.tempevent"+g,function(){!0===a()&&d(f).unbind("scroll.tempevent"+g)})}else d.each([d(h.target),d(h.arrowLeft),d(h.arrowRight)],function(){var a=this;a.on("mouseover.tempevent",function(){c();a.unbind(".tempevent")})});
e.lazyloaded=!0}},redraw:function(){var b=this.internal,c=this.options,a=d(this.element);if(d(c.target).is(":visible")||d(c.target).not(":hidden")){void 0===this.unitWidth&&this._setUnitWidth();this._setTargetWidth();this._setArrowVisibility();if(d.isFunction(this.options.onRedraw))this.options.onRedraw(a,b,c);!0===c.lazyload&&this._lazyLoad()}},getCurrentSlide:function(){return this.internal.currentSlide},goToSlide:function(b,c){var a=this,e=this.internal,g=this.options,h=d(g.target),f;c=void 0!==
c?c:!0;h.not(":hidden")&&(void 0===this.unitWidth&&this._setUnitWidth(),f="individual"===g.unitWidth?d(g.unitElement).eq(b).data("responsiveCarousel").left:-1*b*e.unitWidth,e.busy=!0,!0===c?this._animate(h,{left:f},g.speed,function(){e.busy=!1;a._setArrowVisibility("goto slide")}):h.css("left",f))},toggleSlideShow:function(){!1===this.internal.slideShowActive?this.startSlideShow():this.stopSlideShow()},_step:function(b){var c=this,a=this.internal,e=this.options,g=d(e.target),h=a.maskWidth,f=this._round(Math.floor(g.position().left)),
l=f+b*a.unitWidth,k=f+a.targetWidth;b=k+b*a.unitWidth;var m=l;!1===a.slideBumped?!1===e.infinite&&(b<=h&&(m=l+h-b,a.slideBumped="left"),0<=l&&(a.slideBumped="right",m=0)):("left"===a.slideBumped&&(m=0),"right"===a.slideBumped&&(m=f+h-k),a.slideBumped=!1);a.busy=!0;this._animate(g,{left:m},e.speed,function(){a.busy=!1;c._setArrowVisibility("_step")})},startSlideShow:function(){var b=this,c=this.internal,a=this.options;!1===c.slideShowActive&&(c.slideShowActive=!0,c.slideTimer=f.setInterval(function(){b._step(a.step)},
a.slideSpeed))},stopSlideShow:function(){var b=this.internal;!0===b.slideShowActive&&(b.slideShowActive=!1,f.clearInterval(b.slideTimer))},_destroy:function(){var b=d(this.options.target),c=d(this.options.mask);f.clearTimeout(this.internal.setWidthTimer);f.clearInterval(this.internal.slideTimer);f.clearTimeout(this.internal.scrollTimer);f.clearTimeout(this.internal.resizeTimer);f.cancelAnimationFrame(this.internal.dragTimer);d(f).unbind(this.instanceId);d(q).unbind(this.instanceId);d(this.options.arrowLeft).unbind(this.instanceId);
d(this.options.arrowRight).unbind(this.instanceId);b.removeClass("instance-"+p);b.find("img").unbind(this.instanceId);null!==this.internal.touchObject&&this.internal.touchObject.destroy();c.css({"-webkit-user-select":"","-webkit-user-drag":"","-webkit-tap-highlight-color":""});b.replaceWith(this.internal.backup)},computeAdjust:function(b){var c=this.internal,a=this.options,e=c.scrollStart.left;b=b.position().left;var g=c.maskWidth,h=0,f=c.nudgeDirection,l=c.unitWidth,k=!1;null!==f&&("left"===f&&(h=
e-l),"right"===f&&(h=e+l),"abort"===f&&(h=b),b=h,c.nudgeDirection=null);e=b+c.targetWidth;e<g&&(b=h=b+g-e,k=!0);0<b&&(b=h=0);if("individual"===a.unitWidth)for(f=0;f<c.numUnits;f+=1)if(e=d(a.unitElement).eq(f),!0===k)c.targetWidth>g&&(h=c.maskWidth-c.targetWidth);else{if(Math.abs(b)>=e.data("responsiveCarousel").left&&Math.abs(b)<=e.data("responsiveCarousel").right){h=-1*e.data("responsiveCarousel").left;break}}else h=this._round(b);!0===isNaN(h)&&(h=0);return h},getNumVisibleUnits:function(){return this.internal.numVisibleUnits}})})(jQuery,
window,document);
